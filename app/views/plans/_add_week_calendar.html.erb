<h3><%= my_date Time.now.beginning_of_week + @start_date.days %> - <%= my_date Time.now.beginning_of_week + @start_date.days + 7.days %> </h3>

<table class="calendar">

    <tr>
        <th width="70">datum</th>

        <% for place in @places %>
            <th width="90"><%= place.name %></th>
        <% end %>
    </tr>

    <%  7.times { |n|  %>
        <% table_day = Time.now.beginning_of_week + @start_date.days + n.days %>
        <tr height="30" <% if Time.today ==  table_day -%>
                class="today"
            <%  elsif n > 4 -%>
                class="weekend"
            <%  else %>
                class="<%= cycle("even", "odd") -%>"
            <% end -%>
            >
            <th><%= day_names(n) %> <%= my_date table_day %> </th>
            <% for place in @places %>
                    <% planed_works = Work.find(:all , :conditions => ['deleted is null AND place_id = :place AND time > :morning_date AND time < :evening_date ', {:place => place.id, :morning_date => table_day , :evening_date => table_day + 24.hours }]).sort_by {|u| u.time} %>
							<% day_place_id = "calendar_"+table_day.strftime("%s")+"_"+place.id.to_s %>
                    <td id="<%= day_place_id %>">
                        <% if planed_works.size > 0 %>
                            <% for planed_work in planed_works %>
                                <%= render :partial => 'plans/add_cell', :locals => {:planed_work => planed_work} %>
                            <% end %>
                        <% end %>
                    </td>
							<%= drop_receiving_element(day_place_id,                             # The id of the receiving element
							  :accept => "planed_work_"+place.job_types[0].id.to_s,                                         # The CSS class of the dropped element
							  :update => day_place_id,
							  :position => "bottom",
							  :droponempty => true,
							  :loading => visual_effect(:fade),							
							  :with   => "'planed_work_id=' + (element.id.split('_').last())",     # The query string parameters
							  :url    => {:action=>:change_place_date, 
												:place_id => place.id, 
												:date => table_day, 
												:job_type => @filtr_type,
							  					:show_type => @filtr_show_type }                          # The action to call
							)%>

            <% end %>

        </tr>
    <% } %>
</table>